import json
from typing import Dict

# –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ category.json –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
# –ó–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–µ–º —Ñ–∞–π–ª, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª —á–∞—Å—Ç—å—é –ø–∞–π–ø–ª–∞–π–Ω–∞ ‚Äî
# –≤ —Ç–µ–∫—É—â–µ–π –∑–∞–≥–ª—É—à–∫–µ evaluate_ad –º—ã –µ–≥–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º, –Ω–æ –æ–Ω –≥–æ—Ç–æ–≤.
try:
    with open("category.json", "r", encoding="utf-8") as f:
        parsed = json.load(f)
except FileNotFoundError:
    parsed = {}  # –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º, –∑–∞–≥–ª—É—à–∫–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç


def evaluate_ad(ad_text: str, target_audience: str) -> Dict[str, float]:
    """
    –ü—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥–ª—É—à–∫–∞-–æ—Ü–µ–Ω—â–∏–∫ —Ä–µ–∫–ª–∞–º—ã.
    –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –º–æ–≥ –±—ã –±—ã—Ç—å –≤—ã–∑–æ–≤ LLM –ø–æ –ø—Ä–æ–º–ø—Ç—É,
    –Ω–æ —Å–µ–π—á–∞—Å –º—ã —Å—á–∏—Ç–∞–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–ª–∏–∫–∞/–ø–æ–∫—É–ø–∫–∏ –ø–æ –ø—Ä–æ—Å—Ç—ã–º –ø—Ä–∞–≤–∏–ª–∞–º,
    —á—Ç–æ–±—ã –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–ª –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API.

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    {
        "click_probability": float –æ—Ç 0 –¥–æ 1,
        "purchase_probability": float –æ—Ç 0 –¥–æ 1
    }
    """
    text_lower = ad_text.lower()

    # –ë–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ä—Ç
    score = 0.5

    # –≠–≤—Ä–∏—Å—Ç–∏–∫–∏: –Ω–∞–ª–∏—á–∏–µ —Å–ª–æ–≤ "—Å–∫–∏–¥–∫–∞", "–±–µ—Å–ø–ª–∞—Ç–Ω–æ", "–Ω–æ–≤–∏–Ω–∫–∞" –∏ —Ç.–ø.
    if "—Å–∫–∏–¥" in text_lower:
        score += 0.2
    if "–±–µ—Å–ø–ª–∞—Ç" in text_lower:
        score += 0.1
    if "–Ω–æ–≤–∏–Ω" in text_lower:
        score += 0.05

    # –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π ‚Äî —Ö—É–∂–µ
    length = len(ad_text)
    if length < 80:
        score -= 0.1
    elif length > 600:
        score -= 0.1

    # –ù–µ–º–Ω–æ–≥–æ —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–∏–ø –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Å–µ–≥–º–µ–Ω—Ç–∞
    if "low_income" in target_audience.lower() and "—Å–∫–∏–¥" in text_lower:
        score += 0.05  # –¥–ª—è –º–∞–ª–æ–æ–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Å–∫–∏–¥–∫–∞ –≤–∞–∂–Ω–µ–µ

    # –ù–æ—Ä–º–∏—Ä—É–µ–º –≤ [0, 1]
    click_probability = max(0.0, min(1.0, score))
    purchase_probability = max(0.0, min(1.0, score - 0.1))

    return {
        "click_probability": click_probability,
        "purchase_probability": purchase_probability,
    }


if __name__ == "__main__":
    # –ü—Ä–∏–º–µ—Ä —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
    test_ad = """iPhone 17 ‚Äî —Ç–≤–æ–π —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π!
–û—â—É—Ç–∏ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å, —É–ª—É—á—à–µ–Ω–Ω—É—é –∫–∞–º–µ—Ä—É –∏ –¥–æ–ª–≥–∏–π —Å—Ä–æ–∫ —Ä–∞–±–æ—Ç—ã –±–∞—Ç–∞—Ä–µ–∏.
üí• –°–∫–∏–¥–∫–∞ 10% —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è!"""

    scores = evaluate_ad(test_ad, "Low_income_pragmatic_youth")
    print("–û—Ü–µ–Ω–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Ä–µ–∫–ª–∞–º—ã:", scores)